<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shopping Cart Example with Session Storage</title>
</head>
<body>
    <h1>Store Items</h1>
    <div id="storeContainer"></div>

    <h2>Cart</h2>
    <p id="cartCount">Items in cart: 0</p>
    <div id="cartContent"></div>

    <script>
        // Check if session storage is enabled
        function sessionStorageEnabled() {
            try {
                sessionStorage.setItem('test', 'test');
                sessionStorage.removeItem('test');
                return true;
            } catch (e) {
                return false;
            }
        }

        function getCartFromStorage() {
            return JSON.parse(sessionStorage.getItem('cart')) || {};
        }

        // Function to add item to cart
        function addItemToCart(itemName) {
            let cart = getCartFromStorage();
            if (cart[itemName]) {
                cart[itemName]++;
            } else {
                cart[itemName] = 1;
            }

            sessionStorage.setItem('cart', JSON.stringify(cart));
            console.log(`Item ${itemName} added to cart. Quantity: ${cart[itemName]}`);
            displayCart();
        }

        // Function to remove item from cart
        function removeItemFromCart(itemName) {
            let cart = getCartFromStorage();
            if (cart[itemName]) {
                delete cart[itemName];
            }

            sessionStorage.setItem('cart', JSON.stringify(cart));
            console.log(`Item ${itemName} removed from cart.`);
            displayCart();
        }

        // Function to clear the cart
        function clearCart() {
            sessionStorage.removeItem('cart');
            console.log('Cart cleared.');
            displayCart();
        }

        // Function to create store and add items to the list
        function createStore() {
            const itemNames = ['Shampoo','Soap', 'Sponge', 'Water'];
            
            let storeContainer = document.getElementById('storeContainer');
            
            // Create and append h2 element
            let h2 = document.createElement('h2');
            h2.textContent = 'Available products:';
            storeContainer.appendChild(h2);

            // Create and append ul element
            let ul = document.createElement('ul');
            itemNames.forEach(itemName => {
                let li = document.createElement('li');
                li.textContent = itemName;
                li.style.cursor = 'pointer'; // Make it look clickable
                li.onclick = () => addItemToCart(itemName);
                ul.appendChild(li);
            });

            storeContainer.appendChild(ul);
        }

        // Function to display the number of items in the cart and the content
        function displayCart() {
            let cart = getCartFromStorage();
            let cartCount = 0;
            let cartContent = document.getElementById('cartContent');
            cartContent.innerHTML = ''; // Clear previous content

            // Add "Clear my cart" item at the top
            let clearCartItem = document.createElement('p');
            clearCartItem.innerHTML = '<a href="#" id="clearCart">(Clear my cart)</a>';
            cartContent.appendChild(clearCartItem);

            for (let itemName in cart) {
                cartCount += cart[itemName];
                const rmMessage = `${itemName} x ${cart[itemName]} <a href="#" class="rmItem" data-item="${itemName}">(remove)</a>`;
                let p = document.createElement('p');
                p.innerHTML = rmMessage;
                cartContent.appendChild(p);
            }

            document.getElementById('cartCount').textContent = `Items in cart: ${cartCount}`;

            // Add event listeners to remove links
            document.querySelectorAll('.rmItem').forEach(link => {
                link.addEventListener('click', (event) => {
                    event.preventDefault();
                    let itemName = event.target.getAttribute('data-item');
                    removeItemFromCart(itemName);
                });
            });

            // Add event listener to "Clear my cart" link
            document.getElementById('clearCart').addEventListener('click', (event) => {
                event.preventDefault();
                clearCart();
            });
        }

        // Initial load of items and display cart count
        document.addEventListener('DOMContentLoaded', () => {
            if (!sessionStorageEnabled()) {
                alert("Session storage is not enabled in your browser.");
                return;
            }
            createStore();
            displayCart();  // Initialize the cart count and content
        });
    </script>
</body>
</html>
